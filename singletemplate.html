<style>
.pagination {
 display: none;
}
</style>
<!-- Modal -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title" id="qrModalLabel">QR-Code für diese Lernhilfe</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
      </div>
      <div class="modal-body text-center">
        <div id="qrcode" class="d-flex justify-content-center my-3"></div>
        <a type="button" id="downloadQR" class="btn btn-primary" download="qr-code.png" href="#">
          QR-Code herunterladen
        </a>
       <div class="input-group mb-3" style="margin-top: 4px">
          <input type="text" class="form-control" id="pageLink" readonly>
          <button type="button" class="btn btn-primary" id="copyLinkBtn">Link kopieren</button>
        </div>

        <div id="copyAlert" class="text-success small" style="display:none;">Link kopiert!</div>
      </div>
    </div>
  </div>
</div>

<script>
const qrModal = document.getElementById('qrModal');
qrModal.addEventListener('shown.bs.modal', () => {
  const qrDiv = document.getElementById('qrcode');
  const downloadLink = document.getElementById('downloadQR');
  const pageLink = document.getElementById('pageLink');
  qrDiv.innerHTML = '';

  const url = window.location.href;
  pageLink.value = url; // Textlink setzen

  // QR-Code generieren
  const qr = new QRCode(qrDiv, {
    text: url,
    width: 200,
    height: 200,
    correctLevel: QRCode.CorrectLevel.M
  });

  // Download-Link setzen
  setTimeout(() => {
    const img = qrDiv.querySelector('img') || qrDiv.querySelector('canvas');
    if (!img) return;
    const dataUrl = img.tagName === 'IMG' ? img.src : img.toDataURL('image/png');
    const safeTitle = document.title.replace(/[^a-z0-9-_äöüß ]/gi, '').replace(/\s+/g, '-').toLowerCase();
    downloadLink.href = dataUrl;
    downloadLink.download = `${safeTitle || 'qr-code'}.png`;
  }, 200);
});

// Copy-to-Clipboard
document.getElementById('copyLinkBtn').addEventListener('click', () => {
  const pageLink = document.getElementById('pageLink');
  pageLink.select();
  pageLink.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(pageLink.value).then(() => {
    const alertDiv = document.getElementById('copyAlert');
    alertDiv.style.display = 'block';
    setTimeout(() => { alertDiv.style.display = 'none'; }, 1500);
  });
});
</script>
<div style="float: right">##actionsmenu##</div>
   <a href="" data-bs-toggle="modal" data-bs-target="#qrModal"> <h2> <i class="fa fa-qrcode"></i> Lernhilfe zu [[Thema]]</h2></a>
<br><br>
 <button style="width:100%" type="button" class="qr-hilfen btn btn-light" data-bs-toggle="collapse" data-bs-target="#hilfe1">[[Überschrift Hilfe 1]]</button>
   <div id="hilfe1" class="collapse">  <p>[[Hilfe 1]]</p></div>
 <button style="width:100%" type="button" class="qr-hilfen btn btn-light" data-bs-toggle="collapse" data-bs-target="#hilfe2">[[Überschrift Hilfe 2]]</button>
   <div id="hilfe2" class="collapse">  <p>[[Hilfe 2]]</p></div>  
<div class="anzeigen[[Lösung anzeigen]]">

  <button  style="width:100%" type="button" class="qr-hilfen btn btn-danger" data-bs-toggle="collapse" data-bs-target="#hilfe3">Lösung anzeigen</button>
  <div id="hilfe3" class="collapse"> 
   <p>[[Lösung]]</p>
  </div></div> 
<br><br>